# Travis notes

This file documents the travis build process and related triggers used in this
repo. Specific tasks are executed based on special _commit messages_ described
below:

1. `[TRAVIS] Autogenerated files from travis`. This halts the build process at
   the very beginning. This message is used by pushes from travis itself so that
   the builds don't fall in an infinite loop.
2. `[TRAVIS] Generate scores`. This commit signals travis to run the score
   generation script. This message can be used to trigger a score regeneration
   during the epidemic season.
3. `[TRAVIS] Generate ensemble week xx`. This forces travis to generate ensemble
   files for week `xx` in for the current season (real time files).

Every time commits are pushed on the repo, a travis [build
process](https://travis-ci.org/FluSightNetwork/cdc-flusight-ensemble/) is
triggered which does the following:

1. Check if the commit is `[TRAVIS] Autogenerated files from travis`. If yes,
   then exit build.
2. Run tests on csv files. If not on `master` branch, end build here.
3. If commit message is `[TRAVIS] Generate scores`, run score generation scripts
   and push scores and other autogenerated files to github.
4. If commit message is `[TRAVIS] Generate ensemble week xx` (or the build is
   triggered via a `cron` task), run real time ensemble generation script and
   push generated files to master.
5. Build flusight visualizer and push to `gh-pages` branch.

Other than user commits, there are two more triggers for build process.

1. A cron job scheduled at 17:00 Mondays. This triggers ensemble file creation
   process.
2. `xpull` requests from
   [reichlab/2017-2018-cdc-flu-contest](http://github.com/reichlab/2017-2018-cdc-flu-contest).
   This triggers a process which pull recent submissions for component models
   from Reich Lab.
